services:
  proxy:
    build: .
    container_name: opencode-proxy
    network_mode: host
    volumes:
      - ${DATA_PATH:-./data}:/data/opencode
      - ${CONFIG_PATH:-./config}:/home/bun/.config/opencode:ro
      - ${PLUGINS_PATH:-./plugins}:/home/bun/.opencode
    environment:
      - NODE_ENV=production
      - PORT=${PORT:-8080}
      - OPENCODE_DATA_DIR=/data/opencode
      - XDG_DATA_HOME=/data
    restart: unless-stopped
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 512M
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"
    security_opt:
      - no-new-privileges:true
